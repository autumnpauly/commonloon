---
title: "Common Loon Analysis"
author: "Ellie Gabrielson, Will Draxler, Autumn Pauly"
output: github_document
---
# Load Packages and Data

```{r load-packages, message = FALSE}
#install.packages("tidyverse")
library(tidyverse)
library(rmarkdown)
library(scales)
```

```{r loading-dataset}
#loons_2023 <- read_csv("loons_2023.csv")
```

```{r weather-mutation}
loons_2023 %>% 
   mutate(weather_notes = case_when(is.na(weather_notes) ~ "1", 
                                    TRUE ~ weather_notes))
```
## Tidying Data Further
```{r}
loons_2023_behavior <- loons_2023 %>% 
  filter(species == "COMMON LOON") %>% 
  group_by(date, behavior, species, tide, tide_percentage) %>% 
  count(behavior)

loons_2023_behavior

#counting the occurances of behavior of loons
ggplot(data = loons_2023_behavior, mapping = aes(x = behavior)) + 
  geom_bar()

#counting how many low, high, and mid tide observations we have
ggplot(data = loons_2023_behavior, mapping = aes(x = tide)) + 
  geom_bar()

loons_2023 %>% 
  group_by(tide) %>% 
  count(tide)
  
```

We should bootstrap all of the tidal heights so that we have equal observations... maybe not? 

```{r bootstrapping}
#boot_loon_2023 <- loons_2023_behavior %>% 
 # specify(response = behavior) %>% 
 # generate(reps = 15000, type = "bootstrap")
```

# Tidal Condition and Behavior for 2023 and 2024

### Bootstrapping

```{r bootstrapping-tide-behavior}
#download packages
library(boot)

#this is the dataset that we want to sample from? 
loon_tide_behavior <- loons_2023 %>% 
  select(behavior, tide)

#function to obtain R-Squared from the data 
rsq <- function(formula, data, indices)
{
  d <- data[indices,] # allows boot to select sample
  fit <- lm(formula, data=d)
  return(summary(fit)$r.square)
} 

# bootstrapping with 1000 replications
loon_results <- boot(data=loon_tide_behavior, statistic=rsq,
   R=100, formula=behavior~tide)

# view results
loon_results
plot(loon_results)

# get 95% confidence interval
boot.ci(loon_results, type="bca")
```

```{r sampling-tides-behavior}
#this is the dataset that we want to sample from? 
loon_tide_behavior <- loons_2023 %>% 
  select(behavior, tide)


```


We need to use a non-parametric test. Kruskal-Wallace

```{r}
#1 Tidal Condition and Behavior - 2024/2023

#Behavior_tide_ANOVA <- aov(meters_offshore ~ tide, data = loons_2023)
#summary(Behavior_tide_ANOVA)
```

### Kruskal-Wallis Test
A Kruskal-Wallis test is non-parametric method (a one-way ANOVA on ranks) to [insert more here]. Even though our sample sizes are different, we will still be able to use this test, as this test allows for independent samples that have equal or differing sample sizes. 

```{r kw-test-tide-behavior}
kw <- kruskal.test(behavior ~ tide, data = loons_2023)
kw
```

REPORT: The behavior of G. immer was significantly different at various tidal heights (Kruskal-Wallis chi-squared = 12.324, df = 2, p-value = 0.002109).

### Dunn Test
We now need to use the Dunn test to determine which groups are different. 

```{r dunn-test-tide-behavior}
#install packages
# install.packages("ggpubr")
# library(ggpubr)
# installed.packages("rstatix")
# library(rstatix)

ggplot(data = loons_2023, mapping = aes(x = tide, y = ))

#dunn test
dtkw <- loons_2023 %>% dunn_test(behavior ~ tide, p.adjust.method = "bonferroni")
dtkw
```

### Chi-Squared Table
We will be using a Pearson's Ï‡2 test to assess the difference in the distributions of our categorical variables between two independent variables (`tide` and `behavior`). 

**behavior is dependent, is this a good analysis to use? 

```{r chi-squared-table-onlyloons}
#creating table for chi-squared test
forchi <- loons_2023 %>% 
  select(behavior, tide)

chitable <- table(forchi$behavior, forchi$tide)

chitable

#Pearson's Chi-squared test
chisq.test(chitable, correct = FALSE)
```
Does this suggest that behavior is dependent on tidal height?
Let's ask Sean!


# Tidal Conditions and Dive Times - 2024

```{r}

```


# Exposure Level and Abundance

# Exposure Level and Behavior

# 

